# Conte√∫do de ./rollout/dynamic/canary_rules.yml
http:
  routers:
    # Encaminha POST para o Weighted Service do Command
    router-command:
      rule: "Host(`lms-isep.ovh`) && Method(`POST`, `PUT`, `DELETE`, `PATCH`)"
      service: service-command-canary
      entryPoints: ["web"]

    # Encaminha GET para o Weighted Service do Query
    router-query:
      rule: "Host(`lms-isep.ovh`) && Method(`GET`)"
      service: service-query-canary
      entryPoints: ["web"]

  services:
    service-command-canary:
      weighted:
        services:
          - name: command-stable@docker
            weight: 90
          - name: command-canary@docker
            weight: 10

    service-query-canary:
      weighted:
        services:
          - name: query-stable@docker
            weight: 90
          - name: query-canary@docker
            weight: 10